<!DOCTYPE html>
<html lang="en-US">


<!-- Mirrored from hs-furtwangen.github.io/GIS-WiSe-2020-2021/content/L3.4/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2020 16:50:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="stylesheet" href="../../assets/css/styleb6a9.css?v=ea27abaf339b85bc83f8e9f02e46150f2ace2c25">
  <link rel="shortcut icon" type="image/x-icon" href="../../assets/faviconb6a9.ico?v=ea27abaf339b85bc83f8e9f02e46150f2ace2c25">
  <title>Grundlage interaktiver Systeme - Wintersemester 2020/2021</title>
</head>

<body>
  <header class="page-header" role="banner">
    <div class="page-header-inner main-content">
      <div class="logo-wrapper">
        <div class="logo"></div>
      </div>
      <h1 class="project-name"><a href="../../index.html">Grundlagen interaktiver Systeme</a></h1>
      <h2 class="project-tagline">für MIB und OMB – WiSe 2020/2021</h2>
      <em><a href="../index.html#1-html-und-css"><strong>1</strong> HTML und CSS</a></em>
      <em><a href="../index.html#2-typescript"><strong>2</strong> TypeScript</a></em>
      <em><a href="../index.html#3-server-und-datenbanken"><strong>3</strong> Server und Datenbanken</a></em>
    </div>
  </header>
  <main id="content" class="main-content content-wrapper" role="main">
    <h2 id="v-34-datenbankzugriff-über-server"><em>V</em> <strong>3.4</strong> Datenbankzugriff über Server</h2>

<h3 id="mongodb-in-node">MongoDB in Node</h3>
<p>Bisher wurde die Datenbank noch direkt über die MongoShell angesprochen. Damit wir aber die Datenbank ohne manuelles Zutun verwenden können, müssen wir diese mit unserem Node.JS Server verbinden. Was bisher von Hand mit der MongoShell erledigt wurde, soll also das Node.js-Programm bewerkstelligen. Hierzu muss Node zunächst um die entsprechenden Module für die Arbeit mit MongoDB erweitert werden. Führen Sie also die Kommandos <code class="language-plaintext highlighter-rouge">npm install @types/mongodb</code> sowie <code class="language-plaintext highlighter-rouge">npm install mongodb</code> auf der obersten Ebene ihres GIS-Projektes / Repositories aus.</p>

<p>Die Datei <code class="language-plaintext highlighter-rouge">package.json</code> sollte nun neue Einträge unter <code class="language-plaintext highlighter-rouge">dependencies</code> aufweisen, welche auf die Module und Versionen von MongoDB verweisen. Damit weiß dann auch z.B. Heroku, mit welchen Modulen das Projekt arbeitet, ohne dass diese Module im Github-Repository mitgeliefert werden. Überprüfen Sie zudem noch einmal die Datei <code class="language-plaintext highlighter-rouge">.gitignore</code>, damit nicht versehentlich diese Module in Ihre Versionskontrolle geraten.</p>

<p>Das Node-Modul <code class="language-plaintext highlighter-rouge">mongodb</code> stellt verschiedene Standardobjekte zur Verfügung, mit denen die Datenbankoperationen innerhalb der Node-Umgebung ausgeführt werden können. Wie zuvor die Module <code class="language-plaintext highlighter-rouge">http</code> und <code class="language-plaintext highlighter-rouge">url</code> wird auch <code class="language-plaintext highlighter-rouge">mongodb</code> importiert, in diesem Fall z.B. als <code class="language-plaintext highlighter-rouge">Mongo</code>:</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">Mongo</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">mongodb</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="mongoclient">MongoClient</h3>
<p>Stellt, wie zuvor die MongoShell, innerhalb der Node-Umgebung eine Verbindung mit dem Datenbanksystem her. Ein neues MongoClient-Objekt erwartet für seine Erzeugung als Parameter eine URL und gegebenenfalls noch Zusatzoptionen. Die Methode <code class="language-plaintext highlighter-rouge">connect</code> des Mongo Clients liefert eine Promise, auf deren Erfüllung gewartet werden kann.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">mongoClient</span><span class="p">:</span> <span class="nx">Mongo</span><span class="p">.</span><span class="nx">MongoClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Mongo</span><span class="p">.</span><span class="nx">MongoClient</span><span class="p">(</span><span class="nx">_url</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="k">await</span> <span class="nx">mongoClient</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="collection">Collection</h3>
<p>Eine Variable von diesem Typ referenziert direkt eine Collection der Datenbank. Darauf können dann die aus der MongoShell bekannten Operationen ausgeführt werden.</p>
<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">orders</span><span class="p">:</span> <span class="nx">Mongo</span><span class="p">.</span><span class="nx">Collection</span> <span class="o">=</span> <span class="nx">mongoClient</span><span class="p">.</span><span class="nx">db</span><span class="p">(</span><span class="dl">"</span><span class="s2">Test</span><span class="dl">"</span><span class="p">).</span><span class="nx">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">Students</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">orders</span><span class="p">.</span><span class="nx">insert</span><span class="p">({...});</span>
</code></pre></div></div>

<h3 id="implementation">Implementation</h3>

<blockquote>
  <p><strong>Hinweis zu den Videos:</strong> Auch dieses mal gilt wieder: Die Videos kommen aus dem EIA2 Kurs, darum sind evtl. manche Dinge für Sie nicht 1 zu 1 übernehmbar. Die darin vorgestellten Konzepte sind jedoch wichtig und hilfreich für diese Woche.</p>
</blockquote>

<div align="center"><video controls="" width="30%"> 
  <source src="http://games.hs-furtwangen.de/EIA2_Video/L07_V3_Implementation.mp4" type="video/mp4" /> 
<a href="http://games.hs-furtwangen.de/EIA2_Video/L07_V3_Implementation.mp4">Video</a>
</video>    
</div>

<h3 id="test">Test</h3>
<blockquote>
  <ul>
    <li>Starten Sie den Server in einem dritten Terminalfenster. MongoDB sollte den Verbindungsversuch erkennen und eine zweite Connection anzeigen.</li>
    <li>Starten Sie den Client in einem kleinen neuen Browserfenster. Am besten ordnen Sie die Fenster so an, so dass Ihr Bildschirm nun horizontal und vertikal halbiert erscheint.</li>
    <li>Setzen Sie mit dem Client mehrere unterschiedliche Anfragen ab und beobachte die Ausgaben im Serverfenster.</li>
    <li>Fragen Sie mit der MongoShell die Collection “Orders” der Datenbank “Cocktail” ab um zu schauen, ob die Bestellungen/Datensätze eingetragen wurden (oder eben welche Benennung Sie gewählt haben).</li>
    <li>Ersetzen Sie nun im Servercode den URL zum Datenbankserver mit dem von ihrer remote DB kopierten Connection-String (s. L10). Sie können ihn sich auch unter Clusters-&gt;Connect noch einmal anzeigen lassen.</li>
    <li>Starten Sie ihren lokalen Server neu. Setzen Sie mit dem Client weitere Datensätze ab und prüfen Sie in Atlas ob die Datensätze in der Online-Datenbank ankommen.</li>
  </ul>
</blockquote>

<div align="center"><video controls="" width="30%"> 
  <source src="http://games.hs-furtwangen.de/EIA2_Video/L07_V4_Test.mp4" type="video/mp4" /> 
<a href="http://games.hs-furtwangen.de/EIA2_Video/L07_V4_Test.mp4"><img src="../X01_Appendix/Img/video.html" width="25%" /></a>
</video>    
</div>

<h3 id="ausbau">Ausbau</h3>
<blockquote>
  <ul>
    <li>Um es einfacher zu machen, zwischen lokaler und remote DB zu wechseln, können Sie folgendes tun: Erweiteren Sie ihren Server derart, dass beim Start ein Argument entgegen genommen (z.B. eine der beiden Zeichenketten “local” und “remote”) und anhand dessen entschieden wird, ob die lokale oder die Online-Datenbank genutzt wird. (<a href="https://nodejs.org/en/knowledge/command-line/how-to-parse-command-line-arguments/">Info Commandline Argumente Auslesen</a>: Sie brauchen nur die ganz einfachen Basics, und können darum nach dem zweiten Beispiel aufhören zu lesen)
      <ul>
        <li>Lassen Sie nun Heroku Ihren Server bauen. Passen Sie dazu die Steuerdatei <code class="language-plaintext highlighter-rouge">package.json</code> so an, dass der Pfad zum neuen Server eingetragen ist und bei der Startanweisung das Argument mitgegeben wird z.B.
          <div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
<span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">node PfadZumServer/Server.js remote</span><span class="dl">"</span>
<span class="p">},</span>
</code></pre></div>          </div>
        </li>
      </ul>
    </li>
    <li>Implementieren Sie eine Funktion retrieveOrders, welche mit <code class="language-plaintext highlighter-rouge">orders.find()</code> alle Bestellungen ausliest und ein Array von <code class="language-plaintext highlighter-rouge">Orders</code> zurückliefert. Nutzen Sie dazu die asynchrone Funktion <code class="language-plaintext highlighter-rouge">toArray()</code> des von <code class="language-plaintext highlighter-rouge">find()</code> zurückgegebenen Cursor-Objektes.</li>
    <li>Implementieren Sie eine Erweiterung der Funktion <code class="language-plaintext highlighter-rouge">handleRequest</code>, so dass retrieveOrders aufgerufen und das Ergebnis als (JSON-)Zeichenkette in die Serverantwort eingefügt wird, wenn der Server dazu aufgefordert wird, z.B. mit dem Query-String <code class="language-plaintext highlighter-rouge">command=retrieve</code>, oder unter einem eigenen Pfad <code class="language-plaintext highlighter-rouge">/retrieve</code>. Eine Clientsoftware könnte damit die Datensätze abrufen.</li>
  </ul>
</blockquote>

<h3 id="typescript-dokumentation">Typescript Dokumentation</h3>

<p>https://www.typescriptlang.org/</p>

<hr />

<h2 id="-fragen-und-antworten"><strong>?!</strong> Fragen und Antworten</h2>

<p>(die Publikation der Zusammenfassung erfolgt nach dem Q&amp;A-Termin)</p>

<p>Zusammenfassung von: <a href="https://github.com/TawsTm">&lt;TawsTm&gt;</a></p>

<h3 id="aufgrund-von-mogodb-in-gis-ordner-aktualisiert-sich-der-live-server-ständig">Aufgrund von MogoDB in GIS-Ordner aktualisiert sich der Live Server ständig?</h3>
<p>Ihr könnt die html-Datei einfach direkt öffnen, da ihr den Live-Server gerade nicht braucht. Für die Endabgabe müsst ihr schauen, dass ihr die DB nicht in denselben Ordner legt, wenn ihr einen Live-Server benutzt.</p>

<h3 id="server-datenbank-wer-spricht-mit-wem">Server Datenbank Wer spricht mit wem?</h3>
<p>Wir haben unseren Client Server und die Datenbank. Der Server bei Heroku der Client bei Github und die DB bei Mongo. Anfrage von Client an Server, der es verarbeitet und es an die Datenbank weiterleitet. Die Datenbank kommuniziert mit dem Server und der Server gibt im Anschluss an den Client die Antwort.</p>

<h3 id="die-anfrage-an-den-server-läuft-über-eine-url">Die Anfrage an den Server läuft über eine URL?</h3>
<p>Ja, hier kommen GET und POST ins Spiel.</p>

<h3 id="wie-ist-mongodb-aufgebaut">Wie ist MongoDB aufgebaut?</h3>
<p>MongoDB besteht aus einem Clusterkopf, in dem die Datenbanken drin sind, in einer Datenbank können Collections sein. In den Collections finde ich meine Dateien als JavaScript bzw. JSON-Objekte wieder.</p>

<h3 id="wie-ist-es-mit-username-und-passwort-anlegen">Wie ist es mit Username und Passwort anlegen?</h3>
<p>Es geht eine Anfrage an den Server und dieser verarbeitet die eingegebenen Daten und speichert diese im Falle von Richtigkeit in der Datenbank und gibt im besten Fall dem Client eine Rückmeldung.</p>


    <footer class="site-footer">
      <em><a href="../../index.html">Über diesen Kurs</a></em>
      <em><a href="../index.html">Lehrinhalte</a></em>
    </footer>
  </main>
</body>


<!-- Mirrored from hs-furtwangen.github.io/GIS-WiSe-2020-2021/content/L3.4/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 04 Dec 2020 16:50:33 GMT -->
</html>
